<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Rawai System - ÿ£ÿ≠ŸÖÿØ ŸÖÿ≥ŸÑŸÖ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; margin: 0; }
        @media print {
            @page { size: A4; margin: 0 !important; }
            .no-print { display: none !important; }
            .print-page {
                width: 210mm; height: 296mm; position: relative; overflow: hidden;
                background-image: url('letterhead.jpg') !important;
                background-size: 100% 100% !important;
                -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;
            }
        }
        .screen-view { background: #334155; display: flex; justify-content: center; padding: 10px 0; min-height: 100vh; }
        .page-box { width: 210mm; height: 297mm; background: white; background-image: url('letterhead.jpg'); background-size: 100% 100%; position: relative; }
        .qty-btn { background: #e2e8f0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 4px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .qty-btn:active { background: #cbd5e1; transform: scale(0.9); }
    </style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

<script type="text/babel">
    const { useState, useEffect } = React;
    const App = () => {
        const [client, setClient] = useState("ÿ£ÿ≠ŸÖÿØ ŸÖÿ≥ŸÑŸÖ"); 
        const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
        const [ref, setRef] = useState("");

        useEffect(() => {
            const cleanDate = date.replace(/-/g, "");
            setRef(`${cleanDate}-01`);
        }, [date]);

        const [items, setItems] = useState([
            { id: 1, desc: "SK booster box", price: 1000, qty: 0, disc: 0, bonus: 0, net: 0 },
            { id: 2, desc: "SK Booster Serum 30 gm", price: 190, qty: 0, disc: 0, bonus: 0, net: 0 },
            { id: 3, desc: "SK Booster cleanser 150 gm", price: 125, qty: 0, disc: 0, bonus: 0, net: 0 },
            { id: 4, desc: "SK sun protector 30 gm", price: 185, qty: 0, disc: 0, bonus: 0, net: 0 },
            { id: 5, desc: "SK repairing gel 50 gm", price: 220, qty: 0, disc: 0, bonus: 0, net: 0 }
        ]);

        const updateItem = (id, field, val) => {
            setItems(prev => prev.map(it => {
                if (it.id !== id) return it;
                let numericVal = field === 'bonus' ? (parseInt(val) || 0) : val;
                let ni = { ...it, [field]: numericVal };
                
                let totalP = ni.price * (ni.qty || 1);
                if (field === 'disc') ni.net = totalP * (1 - ni.disc/100);
                else if (field === 'net' && totalP > 0) ni.disc = ((totalP - ni.net) / totalP) * 100;
                else if (field === 'price' || field === 'qty') {
                    ni.net = (ni.price * ni.qty) * (1 - ni.disc/100);
                    if (field === 'qty') {
                        let r = [{q:50,b:10},{q:30,b:5},{q:20,b:3},{q:10,b:1}].find(x => val >= x.q);
                        ni.bonus = r ? r.b : 0;
                    }
                }
                return ni;
            }));
        };

        const subtotal = items.reduce((acc, i) => acc + (i.qty > 0 ? i.net : 0), 0);
        const total = subtotal * 1.15;

        return (
            <div className="flex flex-col lg:flex-row">
                <div className="lg:w-96 p-6 bg-white border-l no-print h-screen sticky top-0 overflow-y-auto shadow-2xl">
                    <h2 className="font-black text-blue-900 mb-6 text-xl border-b pb-2 text-right">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</h2>
                    <div className="space-y-4 mb-6 text-right">
                        <div>
                           <label className="text-[10px] font-bold text-gray-400">ÿßŸÑÿπŸÖŸäŸÑ</label>
                           <input type="text" className="w-full p-2 border rounded text-sm font-bold text-right" value={client} onChange={e => setClient(e.target.value)} />
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                            <div><label className="text-[10px] font-bold text-gray-400">ÿ±ŸÇŸÖ ÿßŸÑÿπÿ±ÿ∂</label><input type="text" className="w-full p-2 border rounded text-sm text-right font-bold" value={ref} onChange={e => setRef(e.target.value)} /></div>
                            <div><label className="text-[10px] font-bold text-gray-400">ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</label><input type="date" className="w-full p-2 border rounded text-sm text-right font-bold" value={date} onChange={e => setDate(e.target.value)} /></div>
                        </div>
                    </div>
                    
                    <button onClick={() => window.print()} className="w-full bg-blue-900 text-white py-4 rounded-lg font-black text-lg shadow-lg mb-6">üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ© / ÿ≠ŸÅÿ∏ PDF</button>

                    <div className="border-t pt-4">
                        {items.map(it => (
                            <div key={it.id} className="mb-4 p-3 bg-slate-50 border rounded-lg text-right shadow-sm text-[11px]">
                                <p className="font-black text-slate-700 mb-2">{it.desc}</p>
                                
                                <div className="grid grid-cols-2 gap-2 mb-3">
                                    <div className="flex flex-col gap-1">
                                        <label className="text-[9px] text-gray-400 font-bold">ÿßŸÑÿ≥ÿπÿ±</label>
                                        <input type="number" value={it.price} className="p-1 border text-center font-bold" onChange={e => updateItem(it.id, 'price', parseFloat(e.target.value)||0)} />
                                    </div>
                                    <div className="flex flex-col gap-1">
                                        <label className="text-[9px] text-gray-400 font-bold">ÿßŸÑŸÉŸÖŸäÿ©</label>
                                        <div className="flex items-center gap-1">
                                            <button className="qty-btn" onClick={() => updateItem(it.id, 'qty', Math.max(0, it.qty - 1))}>-</button>
                                            <input type="number" value={it.qty || ""} className="flex-1 p-1 border text-center font-bold bg-white" onChange={e => updateItem(it.id, 'qty', parseInt(e.target.value)||0)} />
                                            <button className="qty-btn" onClick={() => updateItem(it.id, 'qty', it.qty + 1)}>+</button>
                                        </div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-3 gap-1.5 font-bold">
                                    <div className="bg-red-50 p-1 rounded border border-red-100 text-center text-red-600">
                                        <label className="text-[8px] block">ÿÆÿµŸÖ %</label>
                                        <input type="number" value={Math.round(it.disc)} className="w-full bg-transparent text-center" onChange={e => updateItem(it.id, 'disc', parseFloat(e.target.value)||0)} />
                                    </div>
                                    <div className="bg-blue-50 p-1 rounded border border-blue-100 text-center text-blue-700">
                                        <label className="text-[8px] block">ÿßŸÑÿµÿßŸÅŸä</label>
                                        <input type="number" value={Math.round(it.net)} className="w-full bg-transparent text-center" onChange={e => updateItem(it.id, 'net', parseFloat(e.target.value)||0)} />
                                    </div>
                                    <div className="bg-green-50 p-1 rounded border border-green-100 text-center text-green-700">
                                        <label className="text-[8px] block">ÿ®ŸàŸÜÿµ</label>
                                        <div className="flex items-center justify-center gap-1">
                                            <button onClick={() => updateItem(it.id, 'bonus', Math.max(0, it.bonus - 1))}>-</button>
                                            <input type="number" value={it.bonus || ""} className="w-8 bg-transparent text-center" onChange={e => updateItem(it.id, 'bonus', e.target.value)} />
                                            <button onClick={() => updateItem(it.id, 'bonus', it.bonus + 1)}>+</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>

                <div className="flex-1 screen-view">
                    <div className="page-box print-page">
                        <div className="absolute top-[4.8cm] left-[1.5cm] right-[1.5cm] bottom-[5.2cm] flex flex-col font-black" dir="ltr">
                            <div className="flex justify-between items-center mb-6 text-[15px]">
                                <div className="border-[3px] border-blue-900 px-4 py-1">Quotation No.: <span className="text-blue-900">{ref}</span></div>
                                <div className="text-blue-900">Date: {date}</div>
                            </div>
                            <div className="space-y-2 text-left mb-4">
                                <div className="flex items-center gap-4"><span className="text-blue-900 min-w-[65px]">To :</span><span className="border-b border-dotted border-slate-400 flex-1 text-xl h-7">{client}</span></div>
                                <div className="flex items-center gap-4"><span className="text-blue-900 min-w-[65px]">From :</span><span className="text-slate-700 text-lg">Rawai Aljamal Alhaditha Co.</span></div>
                            </div>
                            <table className="w-full text-[14px] border-collapse text-center">
                                <thead>
                                    <tr className="bg-blue-900 text-white">
                                        <th className="p-2 border border-blue-800 text-left">Description</th>
                                        <th className="p-2 border border-blue-800">Price</th>
                                        <th className="p-2 border border-blue-800">Qty</th>
                                        <th className="p-2 border border-blue-800">Total</th>
                                        <th className="p-2 border border-blue-800">%</th>
                                        <th className="p-2 border border-blue-800">Net</th>
                                        <th className="p-2 border border-blue-800">Bonus</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {items.map(it => (
                                        <tr key={it.id} className="border-b h-10 text-slate-800">
                                            <td className="text-left p-1">{it.desc}</td>
                                            <td>{it.price}</td>
                                            <td className="bg-slate-50">{it.qty || '-'}</td>
                                            <td>{it.qty ? (it.price * it.qty) : '-'}</td>
                                            <td className="text-red-600">{it.disc ? Math.round(it.disc) + "%" : "-"}</td>
                                            <td className="text-blue-900">{it.qty ? Math.round(it.net).toLocaleString() : '-'}</td>
                                            <td className="text-green-700">{it.qty && it.bonus ? it.qty + "+" + it.bonus : "-"}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            <div className="mt-4 flex justify-between items-start">
                                <div className="flex border border-blue-900 rounded shadow-sm overflow-hidden text-[11px]">
                                    <div className="bg-blue-900 text-white p-1 [writing-mode:vertical-lr] rotate-180">Bonus</div>
                                    <table className="px-2">
                                        <tr className="border-b font-bold"><td>10+1</td><td>20+3</td><td>30+5</td><td>50+10</td></tr>
                                    </table>
                                </div>
                                <div className="w-72 bg-blue-900 text-white p-4 rounded-2xl">
                                    <div className="flex justify-between text-xs opacity-80"><span>Subtotal:</span><span>{Math.round(subtotal).toLocaleString()} SR</span></div>
                                    <div className="flex justify-between font-black text-2xl border-t border-blue-800 mt-2 pt-2"><span>TOTAL:</span><span>{Math.round(total).toLocaleString()} SR</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
