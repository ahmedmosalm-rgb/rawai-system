<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Rawai System - ÿ£ÿ≠ŸÖÿØ ŸÖÿ≥ŸÑŸÖ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f1f5f9; margin: 0; }
        
        @media print {
            @page { size: A4; margin: 0 !important; }
            html, body { height: 297mm; overflow: hidden; page-break-after: avoid !important; }
            .no-print { display: none !important; }
            .print-page {
                width: 210mm; height: 296mm;
                position: relative; overflow: hidden;
                background-image: url('letterhead.jpg') !important;
                background-size: 100% 100% !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
        .screen-view { background: #334155; display: flex; justify-content: center; padding: 10px 0; min-height: 100vh; }
        .page-box { width: 210mm; height: 297mm; background: white; background-image: url('letterhead.jpg'); background-size: 100% 100%; position: relative; }
    </style>
</head>
<body>

<div id="root"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

<script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
        const [client, setClient] = useState("ÿ£ÿ≠ŸÖÿØ ŸÖÿ≥ŸÑŸÖ"); 
        const [ref, setRef] = useState("2024-001");
        const [date, setDate] = useState(""); // ÿ≥Ÿäÿ™ŸÖ ÿ™ÿπÿ®ÿ¶ÿ™Ÿá ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã

        // ŸÉŸàÿØ ŸÑÿ¨ŸÑÿ® ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸäŸàŸÖ ÿπŸÜÿØ ŸÅÿ™ÿ≠ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        useEffect(() => {
            const today = new Date().toISOString().split('T')[0];
            setDate(today);
        }, []);

        const [items, setItems] = useState([
            { id: 1, desc: "SK booster box", price: 1000, qty: 0, disc: 0, bonus: "", net: 0 },
            { id: 2, desc: "SK Booster Serum 30 gm", price: 190, qty: 0, disc: 0, bonus: "", net: 0 },
            { id: 3, desc: "SK Booster cleanser 150 gm", price: 125, qty: 0, disc: 0, bonus: "", net: 0 },
            { id: 4, desc: "SK sun protector 30 gm", price: 185, qty: 0, disc: 0, bonus: "", net: 0 },
            { id: 5, desc: "SK repairing gel 50 gm", price: 220, qty: 0, disc: 0, bonus: "", net: 0 }
        ]);

        const updateItem = (id, field, val) => {
            setItems(prevItems => prevItems.map(item => {
                if (item.id === id) {
                    let newItem = { ...item, [field]: val };
                    const totalPrice = newItem.price * (newItem.qty || 1);
                    if (field === 'disc') {
                        newItem.net = totalPrice * (1 - val / 100);
                    } else if (field === 'net') {
                        if (totalPrice > 0) newItem.disc = ((totalPrice - val) / totalPrice) * 100;
                    } else if (field === 'price' || field === 'qty') {
                        newItem.net = (newItem.price * newItem.qty) * (1 - newItem.disc / 100);
                        if (field === 'qty') {
                            const rules = [{q:50, b:10},{q:30, b:5},{q:20, b:3},{q:10, b:1}];
                            const rule = rules.find(r => val >= r.q);
                            newItem.bonus = rule ? rule.b.toString() : "";
                        }
                    }
                    return newItem;
                }
                return item;
            }));
        };

        const subtotal = items.reduce((acc, i) => acc + (i.qty > 0 ? i.net : 0), 0);
        const vat = subtotal * 0.15;
        const total = subtotal + vat;

        const shareWhatsApp = () => {
            const message = `*ÿπÿ±ÿ∂ ÿ≥ÿπÿ± ŸÖŸÜ ÿ¥ÿ±ŸÉÿ© ÿ±Ÿàÿßÿ¶ÿπ ÿßŸÑÿ¨ŸÖÿßŸÑ ÿßŸÑÿ≠ÿØŸäÿ´ÿ©*%0A%0A` +
                            `*ÿßŸÑÿ™ÿßÿ±ŸäÿÆ:* ${date}%0A` +
                            `*ÿßŸÑÿπŸÖŸäŸÑ:* ${client}%0A` +
                            `*ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä:* ${Math.round(total).toLocaleString()} ÿ±ŸäÿßŸÑ%0A%0A` +
                            `ÿßŸÑÿ±ÿßÿ®ÿ∑: ${window.location.href}`;
            window.open(`https://wa.me/?text=${message}`, '_blank');
        };

        return (
            <div className="flex flex-col lg:flex-row">
                <div className="lg:w-96 p-6 bg-white border-l no-print h-screen sticky top-0 overflow-y-auto shadow-2xl">
                    <h2 className="font-black text-blue-900 mb-6 text-xl border-b pb-2 text-right">ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ</h2>
                    
                    <div className="space-y-4 mb-6 text-right">
                        <div>
                           <label className="text-[10px] font-bold text-gray-400">ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ (ÿßÿ∂ÿ∫ÿ∑ ŸÑŸÑŸÖÿ≥ÿ≠)</label>
                           <input type="text" className="w-full p-2 border rounded text-sm text-right font-bold focus:bg-yellow-50" value={client} onChange={e => setClient(e.target.value)} onFocus={() => client === "ÿ£ÿ≠ŸÖÿØ ŸÖÿ≥ŸÑŸÖ" && setClient("")} onBlur={() => client === "" && setClient("ÿ£ÿ≠ŸÖÿØ ŸÖÿ≥ŸÑŸÖ")} />
                        </div>
                        <div className="grid grid-cols-2 gap-2">
                            <div>
                               <label className="text-[10px] font-bold text-gray-400">ÿ±ŸÇŸÖ ÿßŸÑÿπÿ±ÿ∂</label>
                               <input type="text" className="w-full p-2 border rounded text-sm text-right font-bold" value={ref} onChange={e => setRef(e.target.value)} />
                            </div>
                            <div>
                               <label className="text-[10px] font-bold text-gray-400">ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿπÿ±ÿ∂</label>
                               <input type="date" className="w-full p-2 border rounded text-sm text-right font-bold" value={date} onChange={e => setDate(e.target.value)} />
                            </div>
                        </div>
                    </div>

                    <div className="flex flex-col gap-2 mb-6">
                        <button onClick={() => window.print()} className="w-full bg-blue-900 text-white py-3 rounded-lg font-black text-sm">üñ®Ô∏è ÿ∑ÿ®ÿßÿπÿ© / ÿ≠ŸÅÿ∏ PDF</button>
                        <button onClick={shareWhatsApp} className="w-full bg-green-600 text-white py-3 rounded-lg font-black text-sm">üí¨ Ÿàÿßÿ™ÿ≥ÿßÿ®</button>
                    </div>

                    <div className="border-t pt-4">
                        {items.map(it => (
                            <div key={it.id} className="mb-4 p-3 bg-slate-50 border rounded-lg text-right shadow-sm">
                                <p className="text-[11px] font-black text-slate-700 mb-2">{it.desc}</p>
                                <div className="grid grid-cols-2 gap-2 mb-2">
                                    <input type="number" value={it.price} className="p-1 border text-xs text-center font-bold" onChange={e => updateItem(it.id, 'price', parseFloat(e.target.value)||0)} />
                                    <input type="number" placeholder="ÿßŸÑŸÉŸÖŸäÿ©" value={it.qty || ""} className="p-1 border text-xs text-center font-bold" onChange={e => updateItem(it.id, 'qty', parseInt(e.target.value)||0)} />
                                </div>
                                <div className="grid grid-cols-3 gap-1.5">
                                    <div className="bg-red-50 p-1 rounded border border-red-100">
                                        <label className="text-[8px] block text-red-500 font-bold text-center">ÿÆÿµŸÖ %</label>
                                        <input type="number" value={Math.round(it.disc)} className="w-full p-1 border-none bg-transparent text-xs text-center text-red-600 font-bold" onChange={e => updateItem(it.id, 'disc', parseFloat(e.target.value)||0)} />
                                    </div>
                                    <div className="bg-blue-50 p-1 rounded border border-blue-100">
                                        <label className="text-[8px] block text-blue-500 font-bold text-center">ÿßŸÑÿµÿßŸÅŸä</label>
                                        <input type="number" value={Math.round(it.net)} className="w-full p-1 border-none bg-transparent text-xs text-center text-blue-700 font-bold" onChange={e => updateItem(it.id, 'net', parseFloat(e.target.value)||0)} />
                                    </div>
                                    <div className="bg-green-50 p-1 rounded border border-green-100">
                                        <label className="text-[8px] block text-green-600 font-bold text-center">ÿ®ŸàŸÜÿµ</label>
                                        <input type="text" value={it.bonus} className="w-full p-1 border-none bg-transparent text-xs text-center text-green-700 font-bold" onChange={e => updateItem(it.id, 'bonus', e.target.value)} />
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>

                <div className="flex-1 screen-view">
                    <div className="page-box print-page">
                        <div className="absolute top-[4.8cm] left-[1.5cm] right-[1.5cm] bottom-[5.2cm] flex flex-col" dir="ltr">
                            <div className="mb-4">
                                <div className="flex justify-between items-center mb-6">
                                    <div className="border-[3px] border-blue-900 px-4 py-1 font-black text-[15px]">Quotation No.: <span className="text-blue-900">{ref}</span></div>
                                    <div className="font-black text-[15px] text-blue-900">Date: {date}</div>
                                </div>
                                <div className="space-y-2 text-left font-black">
                                    <div className="flex justify-start items-center gap-4"><span className="text-blue-900 text-[15px] min-w-[65px]">To :</span><span className="border-b border-dotted border-slate-400 flex-1 text-xl h-7">{client}</span></div>
                                    <div className="flex justify-start items-center gap-4"><span className="text-blue-900 text-[15px] min-w-[65px]">From :</span><span className="text-lg text-slate-700">Rawai Aljamal Alhaditha Co.</span></div>
                                    <div className="flex justify-start items-center gap-4"><span className="text-blue-900 text-[15px] min-w-[65px]">Subject:</span><span className="text-xl text-slate-800 underline decoration-blue-900 underline-offset-4">SK booster</span></div>
                                </div>
                                <p className="text-left font-black mt-4 text-[15px] text-slate-700">Dear Sir,</p>
                            </div>

                            <table className="w-full text-[14px] border-collapse">
                                <thead>
                                    <tr className="bg-blue-900 text-white font-black">
                                        <th className="p-2.5 border border-blue-800 text-left">Description</th>
                                        <th className="p-2.5 border border-blue-800">Price SR</th>
                                        <th className="p-2.5 border border-blue-800">Qty</th>
                                        <th className="p-2.5 border border-blue-800">Total SR</th>
                                        <th className="p-2.5 border border-blue-800">% Disc</th>
                                        <th className="p-2.5 border border-blue-800">Net Price</th>
                                        <th className="p-2.5 border border-blue-800">Bonus</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {items.map(it => (
                                        <tr key={it.id} className="text-center border-b font-black text-slate-800 h-10">
                                            <td className="p-1.5 text-left">{it.desc}</td>
                                            <td className="p-1.5">{it.price}</td>
                                            <td className="p-1.5 bg-slate-50">{it.qty || '-'}</td>
                                            <td className="p-1.5">{(it.price * it.qty) || '-'}</td>
                                            <td className="p-1.5 text-red-600 font-bold">{it.disc ? Math.round(it.disc) + "%" : "-"}</td>
                                            <td className="p-1.5 text-blue-900">{it.qty ? Math.round(it.net).toLocaleString() : '-'}</td>
                                            <td className="p-1.5 text-green-700">{it.qty && it.bonus ? it.qty + "+" + it.bonus : "-"}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>

                            <div className="flex justify-between items-start mt-4">
                                <div className="flex items-center">
                                    <div className="bg-blue-900 text-white p-1 text-[9px] font-bold rounded-l [writing-mode:vertical-lr] rotate-180 h-20 text-center">Bonus System</div>
                                    <table className="text-[11px] text-center border border-blue-900 border-l-0 rounded-r shadow-sm">
                                        <thead className="bg-slate-50 font-black text-blue-900"><tr><th className="px-3 border-b">Qty</th><th className="px-3 border-b">Free</th></tr></thead>
                                        <tbody className="font-bold">
                                            <tr><td className="border-b">10</td><td className="border-b text-blue-900">+1</td></tr>
                                            <tr><td className="border-b">20</td><td className="border-b text-blue-900">+3</td></tr>
                                            <tr><td className="border-b">30</td><td className="border-b text-blue-900">+5</td></tr>
                                            <tr><td>50</td><td className="text-blue-900">+10</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div className="w-72 bg-blue-900 text-white p-4 rounded-2xl shadow-lg">
                                    <div className="flex justify-between text-[12px] opacity-80 mb-0.5"><span>Subtotal:</span><span>{Math.round(subtotal).toLocaleString()} SR</span></div>
                                    <div className="flex justify-between text-[12px] text-red-300 font-bold mb-1.5"><span>VAT (15%):</span><span>{Math.round(vat).toLocaleString()} SR</span></div>
                                    <div className="flex justify-between font-black text-2xl border-t border-blue-800 pt-2"><span>TOTAL:</span><span>{Math.round(total).toLocaleString()} SR</span></div>
                                </div>
                            </div>

                            <div className="mt-auto grid grid-cols-2 pt-4 border-t border-slate-200 items-end mb-2 font-black">
                                <div><p className="text-[13px] text-blue-900 mb-1 uppercase">Payment & Terms:</p><ul className="text-[12px] text-slate-600 leading-tight"><li>‚Ä¢ 1- Cash 5% discount</li><li>‚Ä¢ 2- Payment Terms: 30 Days</li></ul></div>
                                <div className="text-left font-black"><p className="text-[13px] text-blue-900 mb-1 uppercase">Bank Info:</p><div className="text-[12px] text-slate-600 leading-tight"><p>Bank: Bank Alinma</p><p className="text-blue-900">SA2805000068206829136000</p><p className="text-[10px]">VAT No: 314243545400003</p></div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
